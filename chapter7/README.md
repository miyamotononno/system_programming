# 7章 DPソケットを使ったマルチキャスト通信

### UDPとTCPの用途の違い

本性で扱うUDPと6章で扱ったTCPの特徴を比較すると以下の表のようになる。

|  機能  |  UDP  |　TCP |
| ---- | ---- | ---- |
|  信頼性  |  低い(シンプル)  | 高い(ウィンドウ制御、再送制御、輻輳制御、順序整理を行う) |
|  コネクション |  なし(相手のポートに送りつける)  | あり(お互いを認識して送信する) |
|  通信速度  |  高い(とされている) | 低い(とされている) |
|  接続コスト  |  開始時に時間はかからない  | 1.5RTTの時間がかかる |
|  マルチキャスト  |  できる | できない |
|  ブロードキャスト  |  できる  | できない |

### UDPの具体的なアプリケーション

UDPはTCPと比較して、高速な通信速度であり、複数コンピュータに同時に送信できるという利点から以下のアプリケーションに応用されている。

- ドメイン名からIPアドレスを取得するDNSの通信。
- 時計合わせのためのプロトコルのNTP。
- ストリーミング動画、音声プロトコル。例えば、ブラウザ上でP2Pのための動画、音声通信プロトコルWebRTC。
- **かつては、** VPNなどの仮想ネットワークの土台としてもUDPが使われていた。仮想ネットワークでは、そこで張られたTCPコネクションがエラー訂正や順番の制御を行うため、その土台としてTCPを使うとTCP over TCPとなって無駄が多いから、というのがその理由。
- **かつては、**　伝達ロスがあまりないことが期待できる構内LAN専用の高速プロトコル

しかし、現在は、上記の使い分けやアプリケーションの応用は正しいとは限らない。それは以下の理由による。

- セキュリティ上の理由から、VPN接続でも暗号化のためにTLSを経由するSSL-VPNを使われることが増えてきている。SSL-VPNにも3通りの方式があるが、その中にはパケットをHTTP上にくるんで送信するものがある。この場合には、上で使うプロトコルがTCPの場合、どうしてもTCP over TCPになってしまう。
- 独自プロトコルを開発する場合、土台としてUDPを使うということは、通信環境が劣悪な状態での信頼性や、ネットワークに負荷をかけすぎて他の通信の邪魔をしない(フェアネス)など、そういった点について作り込みが必要になる。そのような「安定したプロトコル」のための開発コストは高い。つまり、ネットワークに明るい者が設計し、かつ大規模なフィールドテストが行える環境でないならば、そもそも独自プロトコルを制作しない方がよい。
- ハンドシェイクの時間がかからないUDPでは、短時間で完了するメッセージを大量に送受信する場合はメリットが大きいが、そうでないならばTCPとの差はない。

現在では、アプリケーションレイヤーで使われるプロトコルの多くはTCPを土台にしている。アプリケーションの開発の際は、「ロスしても良い、マルチキャストが必要、ハンドシェイクの手間すら惜しいなどの特別な条件に合致する場合以外はTCP」という洗濯でよい。